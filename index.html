<!DOCTYPE html>
<html>
  <head>

  </head>
  <body style="background:black">
	<div style="text-align:center;margin-top:100px">
		<canvas style="border: 2px solid black;transform:scale(1.5);background:#00eeee " id="canv1" width="256" height="192"></canvas>
	</div>
  </body>
  <script>
	var canvas = document.getElementById('canv1');
	var ctx = canvas.getContext('2d');
	var shoot = false;
	var ballDown = true;
	var textDown = true;
	var hasShot = false;
	var yBall = 160;
	var xBall = 70;
	var yText = 1;
	var txtLevel = 3;
	var movPer = 0;
	var initX, initY;
	var curvX;
	var sizeFactor = 30;
	var lostShot = false;
	var lostFactor = 0.0;
	var theScore = 0;
	var randDir, yFactor;
	
	function init() {
		window.requestAnimationFrame(draw);
	}
	
	function draw() {
		var rnd1 = rnd2 = 1;
		if (shoot) {
			if (!hasShot) {
				rnd1 = randomNumber(0.97, 1.03);
				rnd2 = randomNumber(0.97, 1.03);
				if (textDown) {
					yText=yText+txtLevel;
					if (yText >= 70) {
						textDown = false;
					}
				}
				else {
					yText=yText-txtLevel;
					if (yText <= 8) {
						textDown = true;
					}
				}
			}
			else {
				// shoot animation
				if (!lostShot) {
					movPer++;
					if (initX > 116) {
						curvX = 256-Math.abs(initX-256);
					}
					else {
						curvX = initX;
					}
					var newCoord = getQuadraticBezierXYatPercent({x:initX, y:initY}, {x:curvX, y:0}, {x: 116, y:20}, movPer/50);
					xBall=newCoord.x;
					yBall=newCoord.y;
					sizeFactor=sizeFactor-0.25;
					if (sizeFactor < 10) {
						sizeFactor = 10;
					}
					if (xBall==116) {
						var madeShot = processShot();
						if (!madeShot) {
							if (Math.random() < 0.5) {
								randDir = 256;
							}
							else {
								randDir = 0;
							}
							yFactor = randomNumber(0.7,1.2);
							lostShot = true;
						}
						else {
							showResult(true);
						}
					}
				}
				else {
					lostFactor = lostFactor + 0.02;
					var newCoord = getLineXYatPercent({x:116, y:20}, {x: randDir, y:192*yFactor}, lostFactor);
					xBall=newCoord.x;
					yBall=newCoord.y;
					if (yBall > 193) {
						showResult(false);
					}
				}
			}
		}
		else {
			if (ballDown) {
				yBall++;
				if (yBall >= 180) {
					ballDown = false;
				}
			}
			else {
				yBall--;
				if (yBall <= 135) {
					ballDown = true;
				}
			}
			if (xBall < 0) {
				xBall = 0;
			}
			else if (xBall > 226) {
				xBall = 226;
			}
		}
		ctx.globalCompositeOperation = 'destination-over';
		ctx.clearRect(0, 0, 256, 192); // clear canvas
		ctx.lineWidth = 0.5;
		
		for (var y=0;y<120;y=y+30) { // wall
			for (var x=0;x<256;x=x+40) {
				ctx.strokeRect(x,y,40,15);
			}
		}
		for (var y=15;y<120;y=y+30) {
			for (var x=-20;x<256;x=x+40) {
				ctx.strokeRect(x,y,40,15);
			}
		}
		
		ctx.clearRect(109, 13, 35, 35); // basket
		ctx.clearRect(118, 28, 17, 12);
		ctx.lineWidth = 1.5;
		ctx.strokeRect(109, 13, 35, 35);
		ctx.strokeRect(118, 28, 17, 12);
		ctx.beginPath();
		ctx.ellipse(126, 43, 14, 2, Math.PI, 0, 2 * Math.PI);
		ctx.stroke();
		
		ctx.beginPath();//floor line
		ctx.moveTo(0, 120); 
		ctx.lineTo(256,120);
		ctx.stroke();
		
		ctx.clearRect(200, 20, 50, 35);//scoreBoard
		ctx.strokeRect(200, 20, 50, 35);
		ctx.font = '16px serif';
		ctx.globalCompositeOperation = 'source-over';
		ctx.fillStyle="#000000";
		ctx.fillText("score", 208, 30);
		ctx.strokeText(theScore, 220, 50);
		
		ctx.globalCompositeOperation = 'source-over'; // ball
		ctx.beginPath();
		ctx.arc(xBall*rnd1, yBall*rnd2, sizeFactor/3, 0, 2 * Math.PI);
		ctx.quadraticCurveTo(xBall*rnd1, yBall*rnd2-5, xBall*rnd1, yBall*rnd2);
		ctx.moveTo(xBall*rnd1, yBall*rnd2);
		ctx.quadraticCurveTo(xBall*rnd1, yBall*rnd2+5, xBall*rnd1-sizeFactor/3, yBall*rnd2);
		ctx.fillStyle = "#00eeee";
		ctx.fill();
		ctx.stroke(); 
		
		if (shoot) {
			ctx.clearRect(0, 1, 10, 70);// shoot bar
			ctx.strokeRect(0, 1, 10, 20);
			ctx.strokeRect(0, 20, 10, 10);
			ctx.fillStyle = 'rgb(0, 0, 0)';
			ctx.fillRect(0, 20, 10, 10);
			ctx.strokeRect(0, 30, 10, 40);
			ctx.globalCompositeOperation = 'source-over';
			ctx.beginPath();
			ctx.arc(5, yText, 3, 0, 2 * Math.PI);
			ctx.stroke();
		}

		window.requestAnimationFrame(draw);
	}

	function randomNumber(min, max) {
		return Math.random() * (max - min) + min;
	}
	function getLineXYatPercent(startPt,endPt,percent) {
		var dx = endPt.x-startPt.x;
		var dy = endPt.y-startPt.y;
		var X = startPt.x + dx*percent;
		var Y = startPt.y + dy*percent;
		return( {x:X,y:Y} );
	}
	function getQuadraticBezierXYatPercent(startPt,controlPt,endPt,percent) {
		var x = Math.pow(1-percent,2) * startPt.x + 2 * (1-percent) * percent * controlPt.x + Math.pow(percent,2) * endPt.x; 
		var y = Math.pow(1-percent,2) * startPt.y + 2 * (1-percent) * percent * controlPt.y + Math.pow(percent,2) * endPt.y; 
		return( {x:x,y:y} );
	}	
	function processShot() {
		if (yText < 30 && yText > 20) {
			if (Math.random() < 0.8) {
				return true;
			}
		}
		else {
			if (Math.random() < 0.2) {
				return true;
			}
		}
		return false;
	}
	function showResult(madeBasket) {
		if (madeBasket) {
			theScore++;
		}
		else {
		
		}
	
		movePer = 0;
		lostFactor = 0.0;
		lostShot = false;
		hasShot = false;
		shoot = false;
		sizeFactor = 30;
		ballDown = true;
		textDown = true;
		yBall = 160;
		xBall = 70;
		yText = 1;
		txtLevel = 3;
		movPer = 0;
	}
	//
	document.addEventListener("keypress", function onEvent(event) {
		switch (event.key) {
			case "o":
				xBall=xBall-2;
				break;
			case "p":
				xBall=xBall+2;
				break;
			case "Enter":
				shoot = true;
				break;
		}
	});
	 document.addEventListener('keyup', (event) => {
		const keyName = event.key;
		if (keyName === "Enter") {
			initX = xBall;
			initY = yBall;
			hasShot = true;
		}
	});
	init();

  </script>
</html>
